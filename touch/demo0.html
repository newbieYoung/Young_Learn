<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" >
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
	<title>使用touch事件简单实现轮播组件</title>
	<style type="text/css">
		body{
			padding:0;
			margin:0;
			overflow-x:hidden;
		}
		.container{
			height:150px;
			overflow:hidden;
		}
		.component{
			height:150px;
			font-size:0;
		}
		.component .item{
			display:inline-block;
			width:300px;
			height:150px;
		}
		.component .item.green{
			background-color:green;
		}
		.component .item.blue{
			background-color:blue;
		}
		.component .item.red{
			background-color:red;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="component">
			<div class="item blue"></div>
			<div class="item green"></div>
			<div class="item red"></div>
		</div>
	</div>
	<script src="../node_modules/jquery/dist/jquery.min.js"></script>
	<script type="text/javascript">
		/**
		 * 自定义toumove事件时需要阻止设备默认的touchmove事件，比如页面滑动，否则会出现一些莫名其妙的bug
		 */
		$(document).ready(function(){
			//初始化轮播图
        	var index = 0;//轮播图序号
        	var touchstart = false;
        	var preventDefault = false;//是否阻止页面滑动
        	var isFixed = true;//自动滑动是否完成
        	var screenWidth = window.screen.availWidth;
        	var $slide = $('div.component');
        	var $slidePage = $slide.find('div.item');
        	var slideLength = $slidePage.length;
        	if(slideLength>1){
        		//每屏宽度等于屏幕宽度
        		$slide.css({
	        		'width':slideLength*screenWidth+'px'
	        	});
	        	$slidePage.css({
	        		'width':screenWidth+'px'
	        	});
	        	var startX = 0;
	        	var startY = 0;
	        	var moveX = 0;
	        	var lastMoveX = 0;
	        	var moveY = 0;

      			$slide.on('webkitTransitionEnd transitionend oTransitionEnd otransitionend transitionend',function(){
      				if(!isFixed){
      					isFixed = true;
      					startX = 0;
			        	startY = 0;
			        	moveX = 0;
			        	lastMoveX = 0;
			        	moveY = 0;
      					/* caution */
						$slide.off('touchmove');
        				$slide.off('touchend');
      				}
      			});
	        	$slide.on('touchstart',function(e){
	        		if(isFixed){
	        			var touch = e.originalEvent.touches[0];
		        		$slide.css({
							'transition':'none',
							'-webkit-transition':'none'
						});
						touchstart = true;
		        		startX = touch.clientX;
		        		startY = touch.clientY;
		        		/* caution */
			        	$slide.on('touchmove',function(e){move(e);});
	        			$slide.on('touchend',function(e){end(e)});
	        		}
	        	});

	        	function move(e){
	        		/* caution */
	        		if(isFixed){
	        			var touch = e.originalEvent.touches[0];
	        			moveX = touch.pageX - startX;
	        			if(touchstart){
	        				moveY = touch.pageY - startY;
	        				if(Math.abs(moveX)>Math.abs(moveY)/2){
	        					moveItem(e);
	        					touchstart = false;
	        					preventDefault  = true;
	        				}else{
	        					touchstart = false;
	        					preventDefault  = false;//否则默认为用户想滑动页面
	        				}
	        			}else{
	        				if(preventDefault){
	        					moveItem(e)
	        				}
	        			}
	        		}
	        	}
	        	function moveItem(e){
	        		e.preventDefault();//阻止默认滑动
	        		absX = Math.abs(moveX);
        			if(index==0&&moveX>0){
	        			//第一幕不能再向左移动
	        		}else if(index==(slideLength-1)&&moveX<0){
	        			//最后一幕不能再向右移动
	        		}else{
	        			if((moveX-lastMoveX)*moveX>=0){//方向一致
	        				if(absX>=parseInt(screenWidth/2)){
		        				//已经滑动过半，触发了自动移动
		        				isFixed = false;
		        				if(moveX<0){
		        					index = index+1;//向右边
		        				}else{
		        					index = index-1;//向左边
		        				}
	        					$slide.css({
		        					'transition':'transform 0.5s ease-out',
		        					'-webkit-transition':'-webkit-transform 0.5s ease-out',
		        					'transform':'translateX('+(-index*screenWidth)+'px)',
		        					'-webkit-transform':'translateX('+(-index*screenWidth)+'px)'
		        				});
		        			}else{
		        				lastMoveX = moveX;
		        				$slide.css({
									'transform':'translateX('+(-index*screenWidth+moveX)+'px)',
									'-webkit-transform':'translateX('+(-index*screenWidth+moveX)+'px)',
								});
		        			}
	        			}else{//移动过程中方向变化，触发自动移动回到原始位置
	        				isFixed = false;
	        				$slide.css({
								'transition':'transform 0.5s ease-out',
								'-webkit-transition':'-webkit-transform 0.5s ease-out',
								'transform':'translateX('+(-index*screenWidth)+'px)',
								'-webkit-transform':'translateX('+(-index*screenWidth)+'px)'
							});
	        			}
	        		}
	        	}
	        	function end(e){
	        		//touch结束，如果还没触发自动移动，要么自动移动到初始位置，要么自动移动下一个位置
	        		if(isFixed){
	        			if(index==0&&moveX>0){
		        			//第一幕不能再向左移动
		        		}else if(index==(slideLength-1)&&moveX<0){
		        			//最后一幕不能再向右移动
		        		}else{
		        			if(Math.abs(moveX)>0&&preventDefault){
		        				isFixed = false;
		        				$slide.css({
									'transition':'transform 0.5s ease-out',
									'-webkit-transition':'-webkit-transform 0.5s ease-out',
									'transform':'translateX('+(-index*screenWidth)+'px)',
									'-webkit-transform':'translateX('+(-index*screenWidth)+'px)'
								});
		        			}
		        		}
	        		}
	        	}
        	}
        
		});
	</script>
</body>
</html>