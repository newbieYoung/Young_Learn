<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>视频事件相关</title>
</head>
<body>
	<h1 id="progress">loading</h1>
	<h1 id="time">loading</h1>
	<video preload="auto" style="background-color:blue;">
		<source src="./step1.mp4" type="video/mp4">
	</video>
	<script src="../node_modules/jquery/dist/jquery.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			var progress = '';
			var $progress = $('#progress');

			var time = '';
			var $time = $('#time');

			var $videos = $('video');
			/**
			 * 视频是以流的形式加载，canplaythrough表示已经可以播放了，而不是整个视频已经完全加载完成
			 */
			$videos.on('canplaythrough',function(){
				console.log('canplaythrough');
			});

			//同一段视频不断重复播放，触发该事件的次数以及对应时间点不一定相同
			$videos.on('timeupdate',function(){
				time += '('+$videos[0].currentTime+')'
				if($videos[0].currentTime>=3){
					$videos[0].currentTime = 0;//重现设置播放时间
					$videos[0].play();
				}
				$time.html(time);
			});

			/**
			 * 在IOS系统中canplaythrough事件不会被触发，这时候只能使用progress事件模拟
			 */
			$videos.on('progress',function(){
				var dom = $(this)[0];
				/**
				 * dom.buffered.end(0) 当前已加载时间
				 * dom.duration 整个视频的持续时间
				 */
				console.log(dom.buffered.end(0)/dom.duration);
				progress += '('+dom.buffered.end(0)+'/'+dom.duration+')'
				$progress.html(progress);
			});

			$videos.on('click',function(){
				$videos[0].play();
			});
		});
	</script>
</body>
</html>